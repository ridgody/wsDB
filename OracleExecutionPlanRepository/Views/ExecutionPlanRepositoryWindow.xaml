<!-- ExecutionPlanRepository/Views/ExecutionPlanRepositoryWindow.xaml -->
<Window x:Class="wsDB.OracleExecutionPlanRepository.Views.ExecutionPlanRepositoryWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="실행계획 저장소" Height="700" Width="1200"
        WindowStartupLocation="CenterScreen">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 상단 툴바 -->
        <ToolBarTray Grid.Row="0" Background="LightGray">
            <ToolBar>
                <Button x:Name="RefreshButton" Content="새로고침" Click="RefreshButton_Click" 
                        ToolTip="저장소 새로고침"/>
                <Separator/> 
                <Button x:Name="ImportButton" Content="가져오기" Click="ImportButton_Click" 
                        ToolTip="텍스트 파일이나 클립보드에서 실행계획 가져오기"/>
                <Separator/>
                <TextBox x:Name="SearchTextBox" Width="200" Height="25"
                         KeyDown="SearchTextBox_KeyDown"
                         ToolTip="SQL ID, 실행위치, 쿼리, 메모에서 검색"/>
                <Button x:Name="SearchButton" Content="검색" Click="SearchButton_Click" 
                        ToolTip="검색 실행"/>
                <Button x:Name="ClearSearchButton" Content="초기화" Click="ClearSearchButton_Click" 
                        ToolTip="검색 초기화"/>
                <Separator/>
                <Button x:Name="ExportSelectedButton" Content="선택 내보내기" Click="ExportSelectedButton_Click" 
                        ToolTip="선택된 항목들을 텍스트 파일로 내보내기"/>
                <Button x:Name="DeleteSelectedButton" Content="선택 삭제" Click="DeleteSelectedButton_Click" 
                        ToolTip="선택된 항목들 삭제"/>
            </ToolBar>
        </ToolBarTray>
        
        <!-- 메인 콘텐츠 -->
        <Grid Grid.Row="1" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- 왼쪽: 실행위치 트리 -->
            <GroupBox Grid.Column="0" Header="실행 위치">
                <TreeView x:Name="ExecutionLocationTreeView" 
                          SelectedItemChanged="ExecutionLocationTreeView_SelectedItemChanged">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <TextBlock Text="{Binding DisplayText}"/>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </GroupBox>
            
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="Gray"/>
            
            <!-- 오른쪽: 상세 정보 -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="200"/>
                    <RowDefinition Height="5"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <!-- 상단: 레코드 목록 -->
                <GroupBox Grid.Row="0" Header="저장된 실행계획">
                    <DataGrid x:Name="RecordsDataGrid"
                              AutoGenerateColumns="False"
                              IsReadOnly="True"
                              SelectionMode="Extended"
                              GridLinesVisibility="Horizontal"
                              AlternatingRowBackground="LightGray"
                              SelectionChanged="RecordsDataGrid_SelectionChanged"
                              MouseDoubleClick="RecordsDataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="SQL ID" Binding="{Binding SqlId}" Width="150"/>
                            <DataGridTextColumn Header="실행위치" Binding="{Binding ExecutionLocation}" Width="200"/>
                            <DataGridTextColumn Header="생성일시" Binding="{Binding FormattedCreatedDate}" Width="130"/>
                            <DataGridTextColumn Header="최근접근" Binding="{Binding FormattedLastAccessDate}" Width="130"/>
                            <DataGridTextColumn Header="메모" Binding="{Binding Notes}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>
                
                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" Background="Gray"/>
                
                <!-- 하단: 상세 내용 -->
                <TabControl Grid.Row="2" x:Name="DetailTabControl">
                    <TabItem Header="쿼리">
                        <ScrollViewer>
                            <TextBox x:Name="QueryDetailTextBox"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="White"/>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="바인드 변수">
                        <ScrollViewer>
                            <TextBox x:Name="BindVariablesDetailTextBox"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="White"/>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="실행계획">
                        <ScrollViewer>
                            <TextBox x:Name="ExecutionPlanDetailTextBox"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="White"/>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="분석정보">
                        <ScrollViewer>
                            <TextBox x:Name="AnalysisInfoDetailTextBox"
                                     IsReadOnly="True"
                                     TextWrapping="Wrap"
                                     FontFamily="Consolas"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Auto"
                                     Background="White"/>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="메모">
                        <ScrollViewer>
                            <TextBox x:Name="NotesDetailTextBox"
                                     IsReadOnly="False"
                                     TextWrapping="Wrap"
                                     FontSize="12"
                                     VerticalScrollBarVisibility="Auto"
                                     LostFocus="NotesDetailTextBox_LostFocus"/>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Grid>
</Window>